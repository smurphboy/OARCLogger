{% extends 'base.html' %}
{% block scripts %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css"
   integrity="sha512-hoalWLoI8r4UszCkZ5kL8vayOGVae1oxXe/2A4AO6J9+580uKHDO3JdHb7NzwwzK5xr/Fs0W40kiNHxM9vyTtQ=="
   crossorigin=""/>
<!-- Make sure you put this AFTER Leaflet's CSS -->
<script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"
   integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ=="
   crossorigin=""></script>
<script src="https://ha8tks.github.io/Leaflet.Maidenhead/src/L.Maidenhead.js"></script>
<link rel="stylesheet" href="/static/css/leaflet.awesome-markers.css">
<script src="/static/js/leaflet.awesome-markers.js"></script>
<script src="/static/js/leaflet-providers.js"></script>
{% endblock %}
{% block hero %}is-primary{% endblock %}
{% block content %}
		<div class="bd-hero-heading">
			<h1 class="title is-size-1">
				{% block title %} <p>View a QSO</p> {% endblock %}
			</h1>
		</div>
	</div>
</section>
<style>
.level-is-shrinkable .level-left,
.level-is-shrinkable .level-item,
.level-is-shrinkable .level-right {
  flex-shrink: 1;
}
</style>
<section class="section">
	<div class="box">
        <h3 class="title">QSO from <a href="{{ url_for('callsigns.call', callsign=qso.station_callsign | replace('/', '_')) }}">{{ qso.station_callsign }}</a> to {{ qso.call }} on {{ qso.qso_date }} at {{ qso.time_on }}</h3>
    </div>
    <div class="box">
		<div class="columns">
			<div class="column">
				<div class="box">
					<p class="title has-text-grey">Date & Time</p>
					<nav class="level">
						<div class="level-left">
							<div class="level-item">
								<div class="icon-text">
									<span class="icon">
										<i class="far fa-calendar"></i>
									</span>
									<span><abbr class="has-text-weight-semibold" title="date on which the QSO started">QSO Date:</abbr> {{ qso.qso_date }}</span>
								</div>
							</div>
						</div>
						{% if qso.qso_date_off %}
						<div class="level-right">
							<div class="level-item">
								<div class="icon-text">
									<span class="icon">
										<i class="far fa-calendar"></i>
									</span>
									<span><abbr class="has-text-weight-semibold" title="date on which the QSO ended">QSO Date Off:</abbr> {{ qso.qso_date_off }}</span>
								</div>
							</div>
						</div>
						{% endif %}
					</nav>
					<nav class="level">
						<div class="level-left">
							<div class="level-item">
								<div class="icon-text">
									<span class="icon">
										<i class="far fa-clock"></i>
									</span>
									<span><abbr class="has-text-weight-semibold" title="HHMM or HHMMSS in UTC">QSO Time On:</abbr> {{ qso.time_on }}</span>
								</div>
							</div>
						</div>
						{% if qso.time_off %}
						<div class="level-right">
							<div class="level-item">
								<div class="icon-text">
									<span class="icon">
										<i class="far fa-clock"></i>
									</span>
									<span><abbr class="has-text-weight-semibold" title="HHMM or HHMMSS in UTC in the absence of <QSO_DATE_OFF>, the QSO duration is less than 24 hours.  For example, the following is a QSO starting at 14 July 2020 23:55 and finishing at 15 July 2020 01:00: <QSO_DATE:8>20200714 <TIME_ON:4>2355 <TIME_OFF:4>0100">QSO Date Off:</abbr> {{ qso.time_off }}</span>
								</div>
							</div>
						</div>
						{% endif %}
					</nav>
				</div>
				<div class="box">
					<p class="title has-text-grey">Bands & Modes</p>
					<nav class="level">
						<div class="level-left">
							<div class="level-item">
								<div class="icon-text">
									<span class="icon">
										<i class="fa-solid fa-tower-broadcast"></i>
									</span>
									<span><abbr class="has-text-weight-semibold" title="QSO Band">Band:</abbr> {{ qso.band }}</span>
								</div>
							</div>
						</div>
						{% if qso.band_rx %}
						<div class="level-right">
							<div class="level-item">
								<div class="icon-text">
									<span class="icon">
										<i class="fa-solid fa-tower-broadcast"></i>
									</span>
									<span><abbr class="has-text-weight-semibold" title="in a split frequency QSO, the logging station's receiving band">Band RX:</abbr> {{ qso.band_rx }}</span>
								</div>
							</div>
						</div>
						{% endif %}
					</nav>
					{% if qso.freq or qso.freq_rx %}
					<nav class="level">
						{% if qso.freq %}
						<div class="level-left">
							<div class="level-item">
								<div class="icon-text">
									<span class="icon">
										<i class="fa-solid fa-tower-broadcast"></i>
									</span>
									<span><abbr class="has-text-weight-semibold" title="QSO frequency in Megahertz">Freq:</abbr> {{ qso.freq | MhzFormat }}</span>
								</div>
							</div>
						</div>
						{% endif %}
						{% if qso.freq_rx %}
						<div class="level-right">
							<div class="level-item">
								<div class="icon-text">
									<span class="icon">
										<i class="fa-solid fa-tower-broadcast"></i>
									</span>
									<span><abbr class="has-text-weight-semibold" title="in a split frequency QSO, the logging station's receiving frequency in Megahertz">Freq RX:</abbr> {{ qso.freq_rx | MhzFormat }}</span>
								</div>
							</div>
						</div>
						{% endif %}
					</nav>
					{% endif %}
					<nav class="level">
						<div class="level-left">
							<div class="level-item">
								<div class="icon-text">
									<span class="icon">
										<i class="fa-solid fa-wave-square"></i>
									</span>
									<span><abbr class="has-text-weight-semibold" title="QSO Mode">Mode:</abbr> {{ qso.mode }}</span>
								</div>
							</div>
						</div>
						{% if qso.submode %}
						<div class="level-right">
							<div class="level-item">
								<div class="icon-text">
									<span class="icon">
										<i class="fa-solid fa-wave-square"></i>
									</span>
									<span><abbr class="has-text-weight-semibold" title="QSO Submode">Submode:</abbr> {{ qso.submode }}</span>
								</div>
							</div>
						</div>
						{% endif %}
					</nav>
					{% if qso.sat_mode or qso.sat_name %}
					<nav class="level">
						{% if qso.sat_name %}
						<div class="level-left">
							<div class="level-item">
								<div class="icon-text">
									<span class="icon">
										<i class="fa-solid fa-satellite"></i>
									</span>
									<span><abbr class="has-text-weight-semibold" title="name of satellite">Sat Name:</abbr> {{ qso.sat_name}}</span>
								</div>
							</div>
						</div>
						{% endif %}
						{% if qso.sat_mode %}
						<div class="level-right">
							<div class="level-item">
								<div class="icon-text">
									<span class="icon">
										<i class="fa-solid fa-satellite"></i>
									</span>
									<span><abbr class="has-text-weight-semibold" title="satellite mode">Sat Mode:</abbr> {{ qso.sat_mode }}</span>
								</div>
							</div>
						</div>
						{% endif %}
					</nav>
					{% endif %}
				</div>
                <div class="box">
                    <p class="title has-text-grey">Signal Report</p>
                    <nav class="level">
                        <div class="level-left">
                            <div class="level-item">
                                <div class="icon-text">
									<span class="icon">
										<i class="fas fa-signal"></i>
									</span>
									<span><abbr class="has-text-weight-semibold" title="signal report sent to the contacted station">RST Sent:</abbr> {{ qso.rst_sent }}</span>
								</div>
                            </div>
                        </div>
						<div class="level-right">
							<div class="level-item">
								<div class="icon-text">
									<span class="icon">
										<i class="fas fa-signal"></i>
									</span>
									<span><abbr class="has-text-weight-semibold" title="signal report from the contacted station">RST Received:</abbr> {{ qso.rst_rcvd }}</span>
								</div>
							</div>
						</div>
                    </nav>
                    {% if qso.srx or qso.stx %}
                    <nav class="level">
                        <div class="level-left">
                            <div class="level-item">
                                {% if qso.stx %}
                                <div class="icon-text">
                                    <span class="icon">
                                        <i class="mdi mdi-numeric"></i>
                                    </span>
                                    <span><abbr class="has-text-weight-semibold" title="contest QSO transmitted serial number with a value greater than or equal to 0">Serial Sent:</abbr> {{ qso.stx }}</span>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        {% if qso.srx %}
                        <div class="level-right">
                            <div class="level-item">
                                <div class="icon-text">
                                    <span class="icon">
                                        <i class="mdi mdi-numeric"></i>
                                    </span>
                                    <span><abbr class="has-text-weight-semibold" title="contest QSO received serial number with a value greater than or equal to 0">Serial Received:</abbr> {{ qso.srx }}</span>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </nav>
                    {% endif %}
                    {% if qso.srx_string or qso.stx_string %}
                    <nav class="level">
                        <div class="level-left">
                            <div class="level-item">
                                {% if qso.stx_string %}
                                <div class="icon-text">
                                    <span class="icon">
                                        <i class="fas fa-quote-left"></i>
                                    </span>
                                    <span><abbr class="has-text-weight-semibold" title="contest QSO transmitted information use Cabrillo format to convey contest information for which ADIF fields are not specified in the event of a conflict between information in a dedicated contest field and this field, information in the dedicated contest field shall prevail">Serial String Sent:</abbr> {{ qso.stx_string }}</span>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        {% if qso.srx_string %}
                        <div class="level-right">
                            <div class="level-item">
                                <div class="icon-text">
                                    <span class="icon">
                                        <i class="fas fa-quote-right"></i>
                                    </span>
                                    <span><abbr class="has-text-weight-semibold" title="contest QSO received information use Cabrillo format to convey contest information for which ADIF fields are not specified in the event of a conflict between information in a dedicated contest field and this field, information in the dedicated contest field shall prevail">Serial String Received:</abbr> {{ qso.srx_string }}</span>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </nav>
                    {% endif %}
                </div>
			</div>
			<div class="column">
				<div class="box">
                    <nav class="level">
                        <div class="level-left">
                            <div class="level-item">
                                <p class="title has-text-grey">Locations</p>
                            </div>
                        </div>
                        {% if qso.my_gridsquare and qso.gridsquare %}
                        <div class="level-right">
                            <div class="level-item">
                                <button class="js-modal-trigger button is-link is-small" data-target="modal-js-map">
                                    View Map
                                </button>
                            </div>
                        </div>
                        {% endif %}
                    </nav>
                    {% if qso.gridsquare or qso.my_gridsquare %}
                    <nav class="level">
                        <div class="level-left">
                            <div class="level-item">
                                {% if qso.gridsquare %}
                                <div class="icon-text">
                                    <span class="icon">
                                        <i class="fas fa-location-arrow"></i>
                                    </span>
                                    <span><abbr class="has-text-weight-semibold" title="the contacted station's 2-character, 4-character, 6-character, or 8-character Maidenhead Grid Square">Gridsquare:</abbr> {{ qso.gridsquare }}</span>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        {% if qso.my_gridsquare %}
                        <div class="level-right">
                            <div class="level-item">
                                <div class="icon-text">
                                    <span class="icon">
                                        <i class="fas fa-location-arrow"></i>
                                    </span>
                                    <span><abbr class="has-text-weight-semibold" title="the logging station's 2-character, 4-character, 6-character, or 8-character Maidenhead Grid Square">My Gridsquare:</abbr> {{ qso.my_gridsquare }}</span>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </nav>
                    {% endif %}
                    {% if qso.lat or qso.my_lat %}
                    <nav class="level">
                        <div class="level-left">
                            <div class="level-item">
                                {% if qso.lat %}
                                <div class="icon-text">
                                    <span class="icon">
                                        <i class="fas fa-map-pin"></i>
                                    </span>
                                    <span><abbr class="has-text-weight-semibold" title="the contacted station's latitude and longitude">Lat, Long:</abbr> {{ qso.lat }}, {{ qso.lon }}</span>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        {% if qso.my_lat %}
                        <div class="level-right">
                            <div class="level-item">
                                <div class="icon-text">
                                    <span class="icon">
                                        <i class="fas fa-map-pin"></i>
                                    </span>
                                    <span><abbr class="has-text-weight-semibold" title="the logging station's latitude and longitude">My Lat, My Long:</abbr> {{ qso.my_lat }}, {{ qso.my_lon }}</span>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </nav>
                    {% endif %}
                    {% if qso.sota_ref or qso.my_sota_ref %}
                    <nav class="level">
                        <div class="level-left">
                            <div class="level-item">
                                {% if qso.sota_ref %}
                                <div class="icon-text">
                                    <span class="icon">
                                        <i class="fas fa-mountain"></i>
                                    </span>
                                    <span><abbr class="has-text-weight-semibold" title="the contacted station's International SOTA Reference.">SOTA Ref:</abbr> {{ qso.sota_ref }}</span>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        {% if qso.my_sota_ref %}
                        <div class="level-right">
                            <div class="level-item">
                                <div class="icon-text">
                                    <span class="icon">
                                        <i class="fas fa-mountain"></i>
                                    </span>
                                    <span><abbr class="has-text-weight-semibold" title="	the logging station's International SOTA Reference.">My SOTA Ref:</abbr> {{ qso.my_sota_ref }}</span>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </nav>
                    {% endif %}
                    {% if qso.iota or qso.my_iota %}
                    <nav class="level">
                        <div class="level-left">
                            <div class="level-item">
                                {% if qso.iota %}
                                <div class="icon-text">
                                    <span class="icon">
                                        <i class="mdi mdi-island"></i>
                                    </span>
                                    <span><abbr class="has-text-weight-semibold" title="	the contacted station's IOTA designator, in format CC-XXX, where CC is a member of the Continent enumeration, XXX is the island group designator, where 1 <= XXX <= 999  [use leading zeroes]">IOTA Ref:</abbr> {{ qso.iota }}</span>
                                </div>
                                {% endif %}
                            </div>
                        </div>

                        {% if qso.my_iota %}
                        <div class="level-right">
                            <div class="level-item">
                                <div class="icon-text">
                                    <span class="icon">
                                        <i class="mdi mdi-island"></i>
                                    </span>
                                    <span><abbr class="has-text-weight-semibold" title="the logging station's IOTA designator, in format CC-XXX, where CC is a member of the Continent enumeration, XXX is the island group designator, where 1 <= XXX <= 999  [use leading zeroes]">My IOTA Ref:</abbr> {{ qso.my_iota }}</span>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </nav>
                    {% endif %}
                    {% if qso.wwff_ref or qso.my_wwff_ref %}
                    <nav class="level">
                        <div class="level-left">
                            <div class="level-item">
                                {% if qso.wwff_ref %}
                                <div class="icon-text">
                                    <span class="icon">
                                        <i class="fas fa-seedling"></i>
                                    </span>
                                    <span><abbr class="has-text-weight-semibold" title="the contacted station's WWFF (World Wildlife Flora & Fauna) reference">WWFF Ref:</abbr> {{ qso.wwff_ref }}</span>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        {% if qso.my_wwff_ref %}
                        <div class="level-right">
                            <div class="level-item">
                                <div class="icon-text">
                                    <span class="icon">
                                        <i class="fas fa-seedling"></i>
                                    </span>
                                    <span><abbr class="has-text-weight-semibold" title="the logging station's WWFF (World Wildlife Flora & Fauna) reference">My WWFF Ref:</abbr> {{ qso.my_wwff_ref }}</span>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </nav>
                    {% endif %}
                    {% if qso.dxcc or qso.my_dxcc %}
                    <nav class="level">
                        <div class="level-left">
                            <div class="level-item">
                                {% if qso.dxcc %}
                                <div class="icon-text">
                                    <span class="icon">
                                        <i class="fas fa-flag"></i>
                                    </span>
                                    <span><abbr class="has-text-weight-semibold" title="	the contacted station's DXCC Entity Code <DXCC:1>0 means that the contacted station is known not to be within a DXCC entity.">DXCC:</abbr> {{ qso.dxcc }} : {{ qso.country }}</span>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        {% if qso.my_dxcc %}
                        <div class="level-right">
                            <div class="level-item">
                                <div class="icon-text">
                                    <span class="icon">
                                        <i class="fas fa-flag"></i>
                                    </span>
                                    <span><abbr class="has-text-weight-semibold" title="the logging station's DXCC Entity Code <MY_DXCC:1>0 means that the logging station is known not to be within a DXCC entity.">My DXCC:</abbr> {{ qso.my_dxcc }} : {{ qso.my_country }}</span>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </nav>
                    {% endif %}
                    {% if qso.cqz or qso.my_cq_zone %}
                    <nav class="level">
                        <div class="level-left">
                            <div class="level-item">
                                {% if qso.cqz %}
                                <div class="icon-text">
                                    <span class="icon">
                                        <i class="fas fa-globe-europe"></i>
                                    </span>
                                    <span><abbr class="has-text-weight-semibold" title="	the contacted station's CQ Zone in the range 1 to 40 (inclusive)">CQ Zone:</abbr> {{ qso.cqz }}</span>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        {% if qso.my_cq_zone %}
                        <div class="level-right">
                            <div class="level-item">
                                <div class="icon-text">
                                    <span class="icon">
                                        <i class="fas fa-globe-europe"></i>
                                    </span>
                                    <span><abbr class="has-text-weight-semibold" title="the logging station's CQ Zone in the range 1 to 40 (inclusive)">My CQ Zone:</abbr> {{ qso.my_cq_zone }}</span>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </nav>
                    {% endif %}
                    {% if qso.ituz or qso.my_itu_zone %}
                    <nav class="level">
                        <div class="level-left">
                            <div class="level-item">
                                {% if qso.ituz %}
                                <div class="icon-text">
                                    <span class="icon">
                                        <i class="fas fa-globe-europe"></i>
                                    </span>
                                    <span><abbr class="has-text-weight-semibold" title="the contacted station's ITU zone in the range 1 to 90 (inclusive)">ITU Zone:</abbr> {{ qso.ituz }}</span>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        {% if qso.my_itu_zone %}
                        <div class="level-right">
                            <div class="level-item">
                                <div class="icon-text">
                                    <span class="icon">
                                        <i class="fas fa-globe-europe"></i>
                                    </span>
                                    <span><abbr class="has-text-weight-semibold" title="the logging station's ITU zone in the range 1 to 90 (inclusive)">My ITU Zone:</abbr> {{ qso.my_itu_zone }}</span>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </nav>
                    {% endif %}
                    {% if qso.sig or qso.my_sig %}
                    <nav class="level">
                        <div class="level-left">
                            <div class="level-item">
                                {% if qso.sig %}
                                <div class="icon-text">
                                    <span class="icon">
                                        <i class="fas fa-users"></i>
                                    </span>
                                    <span><abbr class="has-text-weight-semibold" title="the name of the contacted station's special activity or interest group and reference">Sig: Sig Info</abbr> {{ qso.sig }} : {{ qso.sig_info }}</span>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        {% if qso.my_sig %}
                        <div class="level-right">
                            <div class="level-item">
                                <div class="icon-text">
                                    <span class="icon">
                                        <i class="fas fa-users"></i>
                                    </span>
                                    <span><abbr class="has-text-weight-semibold" title="the name of the logging station's special activity or interest group and reference">My Sig: My Sig Info</abbr> {{ qso.my_sig }} : {{ qso.my_sig_info }}</span>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </nav>
                    {% endif %}
                    {% if qso.address or qso.my_street or qso.my_city or qso.my_postal_code or qso.my_country or qso.my_state %}
                    <nav class="level">
                        {% if qso.address %}
                        <div class="box">
                            <div class="level-left level-is-shrinkable">
                                <div class="level-item level-is-shrinkable">
                                    <div class="icon-text">
                                        <span class="icon">
                                            <i class="far fa-address-card"></i>
                                        </span>
                                        <span class="is-flex-wrap-wrap"><abbr class="has-text-weight-semibold" title="the contacted station's complete mailing address: full name, street address, city, postal code, and country">Address:</abbr> {{ qso.address }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                        {% if qso.my_street or qso.my_city or qso.my_postal_code or qso.my_country or qso_my_state %}
                        <div class="box" style="margin-bottom : 24px">
                            <div class="level-right level-is-shrinkable">
                                <div class="level-item level-is-shrinkable">
                                    <div class="icon-text">
                                        <span class="icon">
                                            <i class="far fa-address-card"></i>
                                        </span>
                                        <span style="flex-shrink : 1; flex-wrap : wrap"><abbr class="has-text-weight-semibold" title="the logging station's street, city, postal code and country">My Address:</abbr> {{ qso.my_street }}, {{ qso.my_city }}, {{ qso.my_postal_code }}, {{ qso.my_state}} {{ qso.my_country}}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </nav>
                    {% endif %}
                    {% if qso.vucc_grids or qso.my_vucc_grids %}
                    <nav class="level">
                        <div class="level-left">
                            <div class="level-item">
                                {% if qso.vucc_grids %}
                                <div class="icon-text">
                                    <span class="icon">
                                        <i class="fas fa-th"></i>
                                    </span>
                                    <span><abbr class="has-text-weight-semibold" title="two or four adjacent Maidenhead grid locators, each four characters long, representing the contacted station's grid squares credited to the QSO for the ARRL VUCC award program.  E.g. EN98,FM08,EM97,FM07">VUCC Grids:</abbr> {{ qso.vucc_grids }}</span>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        {% if qso.my_vucc_grids %}
                        <div class="level-right">
                            <div class="level-item">
                                <div class="icon-text">
                                    <span class="icon">
                                        <i class="fas fa-th"></i>
                                    </span>
                                    <span><abbr class="has-text-weight-semibold" title="two or four adjacent Maidenhead grid locators, each four characters long, representing the logging station's grid squares that the contacted station may claim for the ARRL VUCC award program.  E.g. EN98,FM08,EM97,FM07">My VUCC Grids:</abbr> {{ qso.my_vucc_grids }}</span>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </nav>
                    {% endif %}
                    {% if qso.usaca_counties or qso.my_usaca_counties %}
                    <nav class="level">
                        <div class="level-left">
                            <div class="level-item">
                                {% if qso.usaca_counties %}
                                <div class="icon-text">
                                    <span class="icon">
                                        <i class="mdi mdi-town-hall"></i>
                                    </span>
                                    <span><abbr class="has-text-weight-semibold" title="two US counties in the case where the contacted station is located on a border between two counties, representing counties credited to the QSO for the CQ Magazine USA-CA award program.  E.g. MA,Franklin:MA,Hampshire">USACA Counties:</abbr> {{ qso.usaca_counties }}</span>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        {% if qso.my_usaca_counties %}
                        <div class="level-right">
                            <div class="level-item">
                                <div class="icon-text">
                                    <span class="icon">
                                        <i class="mdi mdi-town-hall"></i>
                                    </span>
                                    <span><abbr class="has-text-weight-semibold" title="two US counties in the case where the logging station is located on a border between two counties, representing counties that the contacted station may claim for the CQ Magazine USA-CA award program.  E.g. MA,Franklin:MA,Hampshire">My USACA Counties:</abbr> {{ qso.my_usaca_counties }}</span>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </nav>
                    {% endif %}
                    {% if qso.cnty or qso.my_cnty %}
                    <nav class="level">
                        <div class="level-left">
                            <div class="level-item">
                                {% if qso.cnty %}
                                <div class="icon-text">
                                    <span class="icon">
                                        <i class="mdi mdi-town-hall"></i>
                                    </span>
                                    <span><abbr class="has-text-weight-semibold" title="the contacted station's Secondary Administrative Subdivision (e.g. US county, JA Gun), in the specified format">County:</abbr> {{ qso.cnty }}</span>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        {% if qso.my_cnty %}
                        <div class="level-right">
                            <div class="level-item">
                                <div class="icon-text">
                                    <span class="icon">
                                        <i class="mdi mdi-town-hall"></i>
                                    </span>
                                    <span><abbr class="has-text-weight-semibold" title="the logging station's Secondary Administrative Subdivision (e.g. US county, JA Gun), in the specified format">My County:</abbr> {{ qso.my_cnty }}</span>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </nav>
                    {% endif %}
                    {% if qso.state or qso.cont %}
                    <nav class="level">
                        <div class="level-left">
                            <div class="level-item">
                                {% if qso.state %}
                                <div class="icon-text">
                                    <span class="icon">
                                        <i class="far fa-flag"></i>
                                    </span>
                                    <span><abbr class="has-text-weight-semibold" title="the code for the contacted station's Primary Administrative Subdivision (e.g. US State, JA Island, VE Province)">State:</abbr> {{ qso.state }}</span>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        {% if qso.cont %}
                        <div class="level-right">
                            <div class="level-item">
                                <div class="icon-text">
                                    <span class="icon">
                                        <i class="fas fa-globe-asia"></i>
                                    </span>
                                    <span><abbr class="has-text-weight-semibold" title="the contacted station's Continent">Continent:</abbr> {{ qso.cont }}</span>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </nav>
                    {% endif %}
                </div>
            </div>
		</div>
	</div>
</section>
{% endblock %}
{% block bottombody %}
{% if qso.gridsquare and qso.my_gridsquare %}
<div id="modal-js-map" class="modal">
    <div class="modal-background"></div>
    <div class="modal-card">
        <header class="modal-card-head">
            <p class="modal-card-title">QSO from <a href="{{ url_for('callsigns.call', callsign=qso.station_callsign | replace('/', '_')) }}">{{ qso.station_callsign }}</a> to {{ qso.call }} on {{ qso.qso_date }} at {{ qso.time_on }}</p>
            <button class="delete" aria-label="close"></button>
        </header>
        <section class="modal-card-body">
            <div class="box is-clipped" id="map" style="height : 500px;">
                <script>
                    var locations = {{ locations|tojson }};
                    var map = L.map('map');
                    L.tileLayer.provider('Stamen.Terrain').addTo(map);
                    var mGroup = L.featureGroup().addTo(map);
                    for (var i = 0; i < locations.length; i++) {
                        marker = new L.marker([locations[i][0], locations[i][1]],
                            {icon: L.AwesomeMarkers.icon({icon: locations[i][2], prefix: 'fa', markerColor: locations[i][3]})})
                            .bindPopup(locations[i][4])
                            .addTo(mGroup);
                    };
                    var maidenhead =  L.maidenhead({
                        color : 'rgba(255, 0, 0, 0.4)'
                    }).addTo(map);
    //                console.log(mGroup.getBounds());
    //                map.fitBounds(mGroup.getBounds()); 
                    console.log({{ locations|tojson }})
                </script>
                <!-- Your content -->
            </div>
        </section>
        <footer class="modal-card-foot"></footer>
    </div>
    <button class="modal-close is-large" aria-label="close"></button>
</div>
<script>
    document.addEventListener('DOMContentLoaded', () => {
  // Functions to open and close a modal
  function openModal($el) {
    $el.classList.add('is-active');
    map.invalidateSize();
    map.fitBounds(mGroup.getBounds().pad(0.2));
  }

  function closeModal($el) {
    $el.classList.remove('is-active');
  }

  function closeAllModals() {
    (document.querySelectorAll('.modal') || []).forEach(($modal) => {
      closeModal($modal);
    });
  }

  // Add a click event on buttons to open a specific modal
  (document.querySelectorAll('.js-modal-trigger') || []).forEach(($trigger) => {
    const modal = $trigger.dataset.target;
    const $target = document.getElementById(modal);

    $trigger.addEventListener('click', () => {
      openModal($target);
    });
  });

  // Add a click event on various child elements to close the parent modal
  (document.querySelectorAll('.modal-background, .modal-close, .modal-card-head .delete, .modal-card-foot .button') || []).forEach(($close) => {
    const $target = $close.closest('.modal');

    $close.addEventListener('click', () => {
      closeModal($target);
    });
  });

  // Add a keyboard event to close all modals
  document.addEventListener('keydown', (event) => {
    const e = event || window.event;

    if (e.keyCode === 27) { // Escape key
      closeAllModals();
    }
  });
});
</script>
{% endif %}
{% endblock %}